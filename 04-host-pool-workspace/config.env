#!/bin/bash

################################################################################
# Host Pool & Workspace Configuration for AVD Deployment
#
# This file configures Azure Virtual Desktop host pools and workspaces
# for pooled or personal desktop deployments.
################################################################################

# Load centralized configuration first
CENTRALIZED_CONFIG="${CENTRALIZED_CONFIG:-../config/avd-config.sh}"
if [[ -f "$CENTRALIZED_CONFIG" ]]; then
    source "$CENTRALIZED_CONFIG"
fi

# ============================================================================
# AZURE ENVIRONMENT
# ============================================================================

export SUBSCRIPTION_ID="${SUBSCRIPTION_ID:-}"
export RESOURCE_GROUP_NAME="${RESOURCE_GROUP_NAME:-RG-Azure-VDI-01}"
export LOCATION="${LOCATION:-centralus}"

# ============================================================================
# HOST POOL
# ============================================================================

# Host Pool Name and Type
export HOST_POOL_NAME="${HOST_POOL_NAME:-avd-hostpool}"
export HOST_POOL_DESCRIPTION="${HOST_POOL_DESCRIPTION:-AVD Host Pool}"
export HOST_POOL_TYPE="${HOST_POOL_TYPE:-Pooled}"  # Pooled or Personal

# Load Balancing
export LOAD_BALANCER_TYPE="${LOAD_BALANCER_TYPE:-BreadthFirst}"  # BreadthFirst or DepthFirst
export MAX_SESSION_LIMIT="${MAX_SESSION_LIMIT:-2}"  # Sessions per host

# Validation Environment
export VALIDATION_ENVIRONMENT="${VALIDATION_ENVIRONMENT:-false}"

# ============================================================================
# APPLICATION GROUP
# ============================================================================

# Desktop Application Group
export APP_GROUP_NAME="${APP_GROUP_NAME:-avd-desktop-appgroup}"
export APP_GROUP_DESCRIPTION="${APP_GROUP_DESCRIPTION:-Desktop application group for pooled deployment}"

# ============================================================================
# WORKSPACE
# ============================================================================

# Workspace Name
export WORKSPACE_NAME="${WORKSPACE_NAME:-avd-workspace}"
export WORKSPACE_DESCRIPTION="${WORKSPACE_DESCRIPTION:-Workspace for AVD deployment}"

# Friendly Name (shown in Web/Client)
export WORKSPACE_FRIENDLY_NAME="${WORKSPACE_FRIENDLY_NAME:-AVD Workspace}"

# ============================================================================
# SESSION HOST POOL
# ============================================================================

# Golden Image
export GOLDEN_IMAGE_GALLERY="${GOLDEN_IMAGE_GALLERY:-/subscriptions/SUB_ID/resourceGroups/RG/providers/Microsoft.Compute/galleries/GALLERY}"
export GOLDEN_IMAGE_DEFINITION="${GOLDEN_IMAGE_DEFINITION:-windows11-golden-image}"
export GOLDEN_IMAGE_VERSION="${GOLDEN_IMAGE_VERSION:-latest}"

# Session Host Configuration
export SESSION_HOST_COUNT="${SESSION_HOST_COUNT:-2}"
export SESSION_HOST_SIZE="${SESSION_HOST_SIZE:-Standard_D4s_v5}"
export SESSION_HOST_PREFIX="${SESSION_HOST_PREFIX:-avdhost}"

# ============================================================================
# NETWORKING
# ============================================================================

# VNet for session hosts
export VNET_NAME="${VNET_NAME:-avd-vnet}"
export SESSION_HOSTS_SUBNET_NAME="${SESSION_HOSTS_SUBNET_NAME:-session-hosts-subnet}"

# ============================================================================
# TAGS
# ============================================================================

export TAGS="${TAGS:-environment=production owner=infrastructure workload=avd}"

# ============================================================================
# LOGGING & ARTIFACTS
# ============================================================================

export LOG_LEVEL="${LOG_LEVEL:-INFO}"
export ENABLE_LOGGING="${ENABLE_LOGGING:-1}"
export ARTIFACTS_DIR="${ARTIFACTS_DIR:-artifacts}"

# ============================================================================
# TIMEOUTS
# ============================================================================

export OPERATION_TIMEOUT="${OPERATION_TIMEOUT:-300}"
export POLLING_INTERVAL="${POLLING_INTERVAL:-10}"
