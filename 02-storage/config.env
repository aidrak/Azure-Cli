#!/bin/bash

################################################################################
# Storage Configuration for AVD Deployment
#
# This file configures storage infrastructure (storage accounts, file shares)
# for Azure Virtual Desktop deployments with FSLogix support.
################################################################################

# Load centralized configuration first
CENTRALIZED_CONFIG="${CENTRALIZED_CONFIG:-../config/avd-config.sh}"
if [[ -f "$CENTRALIZED_CONFIG" ]]; then
    source "$CENTRALIZED_CONFIG"
fi

# ============================================================================
# AZURE ENVIRONMENT
# ============================================================================

export SUBSCRIPTION_ID="${SUBSCRIPTION_ID:-}"
export RESOURCE_GROUP_NAME="${RESOURCE_GROUP_NAME:-RG-Azure-VDI-01}"
export LOCATION="${LOCATION:-centralus}"

# ============================================================================
# STORAGE ACCOUNT
# ============================================================================

# Must be globally unique, lowercase, 3-24 characters, alphanumeric only
export STORAGE_ACCOUNT_NAME="${STORAGE_ACCOUNT_NAME:-}"
export STORAGE_ACCOUNT_SKU="${STORAGE_ACCOUNT_SKU:-Premium_LRS}"
export STORAGE_ACCOUNT_KIND="${STORAGE_ACCOUNT_KIND:-FileStorage}"
export STORAGE_ACCOUNT_ACCESS_TIER="${STORAGE_ACCOUNT_ACCESS_TIER:-Premium}"

# ============================================================================
# FILE SHARE (FSLOGIX)
# ============================================================================

export FILE_SHARE_NAME="${FILE_SHARE_NAME:-fslogix}"
export FILE_SHARE_QUOTA_GB="${FILE_SHARE_QUOTA_GB:-1024}"

# ============================================================================
# AUTHENTICATION
# ============================================================================

# Use Entra Kerberos authentication for Premium Files
export ENABLE_ENTRA_KERBEROS="${ENABLE_ENTRA_KERBEROS:-true}"
export ENABLE_SMB_MULTICHANNEL="${ENABLE_SMB_MULTICHANNEL:-true}"

# ============================================================================
# NETWORKING
# ============================================================================

# VNet for private endpoint
export VNET_NAME="${VNET_NAME:-avd-vnet}"
export PRIVATE_ENDPOINT_SUBNET_NAME="${PRIVATE_ENDPOINT_SUBNET_NAME:-private-endpoints-subnet}"

# Private DNS zone
export PRIVATE_DNS_ZONE_NAME="${PRIVATE_DNS_ZONE_NAME:-privatelink.file.core.windows.net}"

# ============================================================================
# TAGS
# ============================================================================

export TAGS="${TAGS:-environment=production owner=infrastructure workload=fslogix}"

# ============================================================================
# LOGGING & ARTIFACTS
# ============================================================================

export LOG_LEVEL="${LOG_LEVEL:-INFO}"
export ENABLE_LOGGING="${ENABLE_LOGGING:-1}"
export ARTIFACTS_DIR="${ARTIFACTS_DIR:-artifacts}"

# ============================================================================
# TIMEOUTS
# ============================================================================

export OPERATION_TIMEOUT="${OPERATION_TIMEOUT:-600}"
export POLLING_INTERVAL="${POLLING_INTERVAL:-10}"
