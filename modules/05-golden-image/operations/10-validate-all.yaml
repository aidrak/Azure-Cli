# ==============================================================================
# Operation: Validate All Installations
# ==============================================================================
operation:
  id: "golden-image-10-validate-all"
  name: "10: Validate All Installations"
  description: "Comprehensive validation of all software installations and configurations"

  # Duration expectations
  duration:
    expected: 120  # 2 minutes
    timeout: 240   # 4 minutes (fail-fast if exceeds)
    type: "FAST"   # FAST (<5min) or WAIT (10+min)

  # Prerequisites (check state.json)
  requires:
    - operation: "golden-image-09-cleanup-temp"
      status: "completed"

  # Validation checks (run after operation completes)
  validation:
    enabled: true
    checks:
      - type: "file_exists"
        path: "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"
        description: "Chrome installed"

      - type: "file_exists"
        path: "C:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\Acrobat.exe"
        description: "Adobe Reader installed"
        alternative_path: "C:\\Program Files (x86)\\Adobe\\Acrobat Reader DC\\Reader\\AcroRd32.exe"

      - type: "file_exists"
        path: "C:\\Program Files\\Microsoft Office\\root\\Office16\\WINWORD.EXE"
        description: "Office 365 installed"

      - type: "registry_key"
        path: "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server"
        description: "RDP registry configured"

  # Template command (variables substituted at runtime)
  template:
    type: "az-vm-run-command"
    command: |
      az vm run-command invoke \
        --resource-group "{{AZURE_RESOURCE_GROUP}}" \
        --name "{{GOLDEN_IMAGE_TEMP_VM_NAME}}" \
        --command-id RunPowerShellScript \
        --scripts "@modules/05-golden-image/operations/10-validate-all.ps1" \
        --output json > artifacts/outputs/golden-image-validate-all.json

  # PowerShell script (can be inline or external file)
  powershell:
    file: "10-validate-all.ps1"
