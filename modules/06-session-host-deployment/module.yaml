# ==============================================================================
# Module: Session Host Deployment
# ==============================================================================
module:
  id: "06-session-host-deployment"
  name: "Session Host Deployment"
  description: "Deploy session host VMs from golden image and register them to the AVD host pool"

  # Module-level configuration
  config:
    resource_group: "{{AZURE_RESOURCE_GROUP}}"
    location: "{{AZURE_LOCATION}}"
    vm_name_prefix: "{{SESSION_HOST_NAME_PREFIX}}"
    vm_count: "{{SESSION_HOST_VM_COUNT}}"
    vm_size: "{{SESSION_HOST_VM_SIZE}}"
    host_pool_name: "{{HOST_POOL_NAME}}"

  # Operations in this module (executed in order)
  operations:
    - id: "session-host-deploy-vms"
      name: "Deploy Session Host VMs"
      description: "Deploy multiple session host VMs from golden image"
      duration: 900  # 15 minutes (parallel deployment)
      type: "WAIT"

    - id: "session-host-register-pool"
      name: "Register to Host Pool"
      description: "Generate registration token and register session hosts to host pool"
      duration: 600  # 10 minutes
      type: "WAIT"

  # Module-level validation (run after all operations complete)
  validation:
    enabled: true
    checks:
      - type: "resource_exists"
        resource_type: "vm"
        description: "Session host VMs created"

      - type: "host_pool_registration"
        description: "Session hosts registered to host pool"

  # Expected total duration
  total_duration:
    expected: 1500  # 25 minutes (sum of all operations)
    timeout: 3000   # 50 minutes (2x expected)

  # Module state file
  state_file: "modules/06-session-host-deployment/state.json"

  # Artifacts
  artifacts:
    logs: "artifacts/logs/"
    outputs: "artifacts/outputs/"
    scripts: "artifacts/scripts/"
